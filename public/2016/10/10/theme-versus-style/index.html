<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Theme和Style的区别 | Haldir的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="认识Theme和Styles
重新看一遍Using Themes and styles without going crazy，大部分属于直接翻译
1. Styles1.1 首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来1&amp;lt;View android:background= &quot;#ff0000&quot; /&amp;gt;
变成
12345&amp;lt;View style= &quot;@St">
<meta property="og:type" content="article">
<meta property="og:title" content="Theme和Style的区别">
<meta property="og:url" content="http://haldir65.github.io/2016/10/10/theme-versus-style/index.html">
<meta property="og:site_name" content="Haldir的博客">
<meta property="og:description" content="认识Theme和Styles
重新看一遍Using Themes and styles without going crazy，大部分属于直接翻译
1. Styles1.1 首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来1&amp;lt;View android:background= &quot;#ff0000&quot; /&amp;gt;
变成
12345&amp;lt;View style= &quot;@St">
<meta property="og:updated_time" content="2016-10-10T19:51:17.483Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Theme和Style的区别">
<meta name="twitter:description" content="认识Theme和Styles
重新看一遍Using Themes and styles without going crazy，大部分属于直接翻译
1. Styles1.1 首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来1&amp;lt;View android:background= &quot;#ff0000&quot; /&amp;gt;
变成
12345&amp;lt;View style= &quot;@St">
  
    <link rel="alternative" href="/atom.xml" title="Haldir的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <script src="/style.js"></script>
</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://odzl05jxx.bkt.clouddn.com/bolg_avatar.jpg" class="js-avatar show" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Haldir</a></h1>
		</hgroup>

		
		<p class="header-subtitle">get busy living</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/android">文章</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">主页</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Haldir65" title="github">github</a>
		        
					<a class="mail" target="_blank" href="mailto:mjw090608@gmail.com" title="mail">mail</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Haldir</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="nullhttp://odzl05jxx.bkt.clouddn.com/bolg_avatar.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Haldir</h1>
			</hgroup>
			
			<p class="header-subtitle">get busy living</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/tags/android">文章</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Haldir65" title="github">github</a>
			        
						<a class="mail" target="_blank" href="mailto:mjw090608@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-theme-versus-style" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Theme和Style的区别
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>认识Theme和Styles</p>
<p>重新看一遍Using Themes and styles without going crazy，大部分属于直接翻译</p>
<h4 id="1-Styles"><a href="#1-Styles" class="headerlink" title="1. Styles"></a>1. Styles</h4><h5 id="1-1-首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来"><a href="#1-1-首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来" class="headerlink" title="1.1 首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来"></a>1.1 首先，在layout文件中，Style可以将一些重复的，具有共性的属性提取出来</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">View</span> <span class="attr">android:background</span>= <span class="string">"#ff0000"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>变成</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>= <span class="string">"@Style/MyStyle"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">Style</span> <span class="attr">name</span> = <span class="string">"MyStyle"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:background"</span>&gt;</span>#ff0000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这种形式，对于大量的具有相同属性的且具有<em>共性</em>的View，可以直接使用对应的Style，这能够让layout文件更加整洁。前提是确信layout文件中使用的View具有相同的属性。</p>
<a id="more"></a>
<h5 id="1-2-Style-Inheritance"><a href="#1-2-Style-Inheritance" class="headerlink" title="1.2 Style Inheritance"></a>1.2 Style Inheritance</h5><p>Style可以继承，两种方式：</p>
<p>假设有parent style ，一种在name中使用前缀的方式指明parent，另一种在后面显式的声明parent</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"Parent"</span>/&gt;</span><span class="undefined"></span></div></pre></td></tr></table></figure>
<p>Explicit child</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"Child"</span> <span class="attr">parent</span> = <span class="string">"Parent"</span>&gt;</span><span class="undefined"></span></div></pre></td></tr></table></figure>
<p>  Implicit Child</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"Parent.Child"</span>/&gt;</span><span class="undefined"></span></div></pre></td></tr></table></figure>
<p>同时使用两种方式时，默认使用Explicit Parent  </p>
<p>为避免混淆，推荐使用Explicit Child且Child name不带前缀  </p>
<p>View不能拥有两个Style,除了TextView及其子类，例如</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span>&gt;</span></div><div class="line">  android:textColor = "#ffffff"</div><div class="line">truestyle="@style/SomeStyle"</div><div class="line">  android:textAppearance = "@style/MyText"</div><div class="line"><span class="tag">&lt;/<span class="name">TextView</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如上所示，TextView中可以定义TextAppearance，后者包含了常见的textColor，textSize等attributes，而在一个View中可以同时定义两个Style。如果出现冲突，styles之间相同attributes的应用优先级为：</p>
<blockquote>
<p>android:textColor &gt;&gt; SomeStyle中的android:textColor&gt;&gt;MyText中的android:textColor</p>
<p>使用TextAppearance 时一定要有一个parent</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"MyText"</span> <span class="attr">parent</span>=<span class="string">"TextAppearance.Appcompat"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:TextColor"</span>&gt;</span>#F08<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>因为使用style时，系统将把style中定义的attribute和当前View的默认attribute融合起来，而TextView默认attribute 中什么也没有，造成textSize = 0的情况，所以务必选择parent，在parent style已经定义好大多数属性的情况下再去修改小部分属性将简单得多。TextAppearance可以在Theme中定义，也可以写在单一的TextView上。</p>
<ul>
<li><p>####2. Themes<br>在Android中，Theme名字以”Theme.”开头，查看源码会发现只是定义了一大堆color attributes 和Window attributes。Themes比Styles的作用范围更广，themes可以在Application,Activity层面管理Widget外观，Theme还可以实现夜间模式切换</p>
<p>来看如何定义一个Theme</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"Theme"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">android:statusBarColor</span>&gt;</span>#ff0000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>回头看一下Style</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Style</span> <span class="attr">name</span> = <span class="string">"Style"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:background"</span>&gt;</span>#ff0000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>语法看起来完全一样。</p>
<p>区别：styles中的属性被直接送到View的构造函数中，记得在自定义View时写的那些attrs吗，其实就是两个参数的构造函数中的AttributeSets</p>
<p>Theme应用范围更广，定义的属性和Style也不尽相同。</p>
<p>两者之间有一些联系：例如Theme中可以定义default widget style，Style可以引用Theme中定义的属性(?attr:selectableItemBackground还记得吗)<br>上面提到了Theme中可以定义default widget style，具体做法无非就是这样:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>= <span class="string">"MyTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light"</span>&gt;</span><span class="xml"></span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:editTextStyle"</span>&gt;</span>@style/MyEditTextStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>所以，只要在AppTheme中点进去，找一下这个键对应的值就可以了</p>
</li>
</ul>
<p>  2.1 使用Theme</p>
<p>  两种方式:</p>
<p>  1.在Manifest中，例如</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">application</span></span></div><div class="line">  <span class="attr">android:theme</span>=<span class="string">"@style/Theme.AppCompat"</span> /&gt;</div><div class="line"></div><div class="line">或者</div><div class="line"><span class="tag">&lt;<span class="name">activity</span></span></div><div class="line">  <span class="attr">android:theme</span>=<span class="string">"@style/Theme.AppCompat.Light"</span>        /&gt;</div></pre></td></tr></table></figure>
<p>  activty中Theme override Application的Theme</p>
<ol>
<li><p>应用于View</p>
<p>Lollipop开始引入View Theming的概念</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Toolbar</span></span></div><div class="line">   <span class="attr">android:theme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span></div><div class="line">   <span class="attr">app:popupTheme</span>=<span class="string">"@style/ThemeOverlay.AppCompa.Light"</span>/&gt;</div></pre></td></tr></table></figure>
<p>  应用在View上的Theme将能够作用在该View及其所有的Children，这样做的好处在于没有必要专门为了一个View而去选择其他的Theme。</p>
<p>  例如在Holo中有Holo.Light.DarkActionBar，为了专门适配ActionBar需要一个专门的Theme。目前看来主要应用在Toolbar上。</p>
<h3 id="3-墙裂推荐使用AppCompat"><a href="#3-墙裂推荐使用AppCompat" class="headerlink" title="3 .墙裂推荐使用AppCompat"></a>3 .墙裂推荐使用AppCompat</h3><p>  好处: </p>
<ul>
<li>Material on all devices ,记得以前听说AppCompat在21以上继承自Theme.Material。</li>
<li><p>Baseline themes/styles AppCompat 预设了一系列样式标准，只需要继承AppCompat，改动一小部分样式就能完成设计</p>
<ul>
<li>Enable View theming pre-Lollipop </li>
<li>使用ColorPrimary , ColorAccent等attributes(backPorted by AppCompat)设置Widget样式</li>
<li>在Theme中可以定义默认的Widget样式，例如<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span> = <span class="string">"Theme.AppCompat"</span>&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:spinnerItemStyle"</span>&gt;</span>@sytle/MySpinnerStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>还可以更改默认样式：</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"AttrTheme"</span> <span class="attr">parent</span> =<span class="string">"Theme.AppCompat"</span>&gt;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> =<span class="string">"selectableItemBackground"</span>&gt;</span>@drawable/bg<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">使用时</div><div class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:background</span>=<span class="string">?attr/selectableItemBackground</span>"/&gt;</span></div></pre></td></tr></table></figure>
<p>这样就可以自定义点击时的Drawable了。</p>
<ul>
<li>支持android:theme: API 7+(只应用于该View)，API 11+(View及其子View) </li>
</ul>
<p>View theming原本只是API 21才引入的概念，AppCompat实现了向前兼容</p>
<h3 id="4-attr的问题"><a href="#4-attr的问题" class="headerlink" title="4 .  ?attr的问题"></a>4 .  ?attr的问题</h3><blockquote>
<p>?android:attr/selectableItemBackground</p>
</blockquote>
<p>一个个来解释：</p>
<p>?  :  we’re doing a theme lookup</p>
<p>android:  we’re looking up something within the android namespace</p>
<p>attr/  : we’re looking for an attribute(可省略)</p>
<p>selectableItemBackground: The name of the atribute we’re looking up</p>
<p>把attr/省略掉后变成</p>
<blockquote>
<p>?android:selectableItemBackground</p>
</blockquote>
<p>效果完全一样</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"MyTheme"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:colorPrimary"</span>&gt;</span>@color/red<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>问题在于android:ColorPromary是Lollipop才引入的，解决方案</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">syle</span> <span class="attr">name</span> = <span class="string">"MyTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat"</span>&gt;</span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"colorPrimary"</span>&gt;</span>@color/red<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">syle</span>&gt;</span></div></pre></td></tr></table></figure>
<p>注意这里没有android: 前缀，AppCompat针对API21之前的版本定义了自己的一套资源。</p>
<p>再举个例子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">在values/attrs.xml中</div><div class="line"><span class="tag">&lt;<span class="name">attr</span> <span class="attr">name:</span>"<span class="attr">myAttribute</span>" <span class="attr">format</span>=<span class="string">"dimension"</span>/&gt;</span></div><div class="line"></div><div class="line">在values/themes.xml中</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"MyTheme"</span> <span class="attr">parent</span> = <span class="string">"Theme.AppCompat"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"myAttribute"</span>&gt;</span>4dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span>  这就是实际使用的Theme</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">在values/styles.xml中</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"MyStyle"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:padding"</span>&gt;</span>?attr/myAttribute<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">实际操作中</div><div class="line">在layout文件中，通过将一个长度，颜色定义为?attr的方式，就会去当前的Theme中寻找相对应的attribute，这就是黑夜模式切换的原理</div></pre></td></tr></table></figure>
<p>要注意的是，所有非android nameSpace的attribute Name都是global的，所以如果两个library定义了相同的attribute Name，将无法编译通过。</p>
<p>Style可以通过?attr的方式引用Theme中的资源</p>
<h3 id="5-获取Theme"><a href="#5-获取Theme" class="headerlink" title="5 .获取Theme"></a>5 .获取Theme</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">context.getTheme().resolveAttribute(R.attr.dialogTheme,outValue,<span class="keyword">true</span>)</div><div class="line">  </div><div class="line">在View中</div><div class="line">  TypedArray a = context.obtainStyledAttributes(attrs,com.android.internal.R.styleable.ImageView,defStyleAttr,defStyleRes)</div><div class="line">  </div><div class="line"><span class="keyword">int</span> alpha = a.getInt(</div><div class="line">  com.android.internal.R.styleable.ImageView_drawableAlpha,<span class="number">255</span>)</div></pre></td></tr></table></figure>
<p>Activity有一个setTheme(int themeResId)方法，注意，这个方法并不是取代原先的Theme,只是在原有的Theme上apply了。所以这个命名不算太好。Activity内部会在onCreate()前调用setTheme(你写在manifest里面的Theme)</p>
<h3 id="6-v21的问题"><a href="#6-v21的问题" class="headerlink" title="6. v21的问题"></a>6. v21的问题</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">在values/styles.xml中</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"BaseToolbar"</span>/&gt;</span><span class="xml"></span></div><div class="line"></div><div class="line">在values-v21/styles.xml中</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>= <span class="string">"BaseToolbar"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:elevation"</span>&gt;</span>4dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">elevation是21以上api才有的属性，lint会提示问题</div><div class="line">这样，在values/styles.xml中</div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span> = <span class="string">"Toolbar"</span> <span class="attr">parent</span> = <span class="string">"BaseToolbar"</span>/&gt;</span><span class="undefined"></span></div><div class="line">lint就不会飙黄了，直接引用Toolbar即可</div></pre></td></tr></table></figure>
<p>通过这种继承的方式能够在自己的Theme中使用统一的theme，针对不同的运行时版本确定最终运行的Theme。</p>
<h3 id="7-ThemeOverlay"><a href="#7-ThemeOverlay" class="headerlink" title="7 . ThemeOverlay"></a>7 . ThemeOverlay</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ThemeOverlay.Material.Light</div><div class="line">ThemeOverlay.Material.Dark</div><div class="line"><span class="comment">//etc ...</span></div></pre></td></tr></table></figure>
<p>用于添加到现有的Theme上，例如Theme.Material.Light只包含color relevant to a light Theme，不会改变原有Theme的window Attributes。查看源码，只是完整的Theme中的一小部分attribute。</p>
<h3 id="8-常见错误"><a href="#8-常见错误" class="headerlink" title="8. 常见错误"></a>8. 常见错误</h3><ol>
<li>作为Theme中引用的style必须要有一个parent</li>
</ol>
<p>例如<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">在AppTheme中</div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:editTextStyle"</span>&gt;</span>@style/MyEditTextStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>= <span class="string">"MyEditTextStyle"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>= <span class="string">"android:fontFamily"</span>&gt;</span></div><div class="line">  sans-serif-medium</div><div class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样做的结果将是所有的EditText都会失去基本的属性</p>
<ol>
<li>defStyleAttr vs defStyleRes</li>
</ol>
<p>常见于 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ObtainStyledAttributes(AttributeSet set,<span class="keyword">int</span> []attrs,</div><div class="line"> <span class="keyword">int</span> defStyleAttr,<span class="keyword">int</span> defStyleRes)</div></pre></td></tr></table></figure>
<p>直接解释：</p>
<blockquote>
<p> defStyleAttr: The attr in your theme which points to the default style</p>
<p> eg: R.attr.editTextStyle</p>
<p> defStyleRes: The resource ID of the default style</p>
<p> eg:R.style.Widget_Material_EditText</p>
</blockquote>
<p>ObtainStyledAttributes查找Value时读取的顺序如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>. Value in the AttributeSet</div><div class="line"><span class="number">2</span>. Value in the explicit style</div><div class="line"><span class="number">3</span>. Default style specified in defStyleRes</div><div class="line"><span class="number">4</span>. Default style specified in defStyleAttr</div><div class="line"><span class="number">5</span>. Base value in <span class="keyword">this</span> theme</div></pre></td></tr></table></figure>
<p>注意最后一条，万一在Manifest中出现这种东西</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Style</span> <span class="attr">name</span> = <span class="string">"AppTheme"</span> <span class="attr">parent</span> = <span class="string">"Theme.AppCompat"</span>&gt;</span><span class="xml"></span></div><div class="line">true<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span> = <span class="string">"android:background"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这意味着</p>
<blockquote>
<p>Any View which doesn’t have a background set ,will use the theme’s value ,  SHIT!</p>
</blockquote>
<h3 id="9-最后，一点好玩的"><a href="#9-最后，一点好玩的" class="headerlink" title="9. 最后，一点好玩的"></a>9. 最后，一点好玩的</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Context themedContext = </div><div class="line">  <span class="keyword">new</span> ContextThemeWrapper(baseContext,R.style.MyTheme);</div><div class="line"></div><div class="line">View view = LayoutInflator.form(themedContext)</div><div class="line">  		.inflate(R.layout.some_layout,<span class="keyword">null</span>);</div><div class="line"><span class="comment">//或者</span></div><div class="line">View view = <span class="keyword">new</span> View(themedContext);</div><div class="line"><span class="comment">//生成的View就会带有MyTheme中的属性，动态设置。</span></div></pre></td></tr></table></figure>
<p>而这也是AppComPat对于API 21以下版本进行兼容的原理<br>翻了一下文档：<br>ContextThemeWrapper : Added in API level 1</p>
<p>这一点AppCompat的作者也在2014年的一篇 <a href="https://chris.banes.me/2014/11/12/theme-vs-style/" target="_blank" rel="external">博客</a>中提到了。</p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ul>
<li><a href="https://www.youtube.com/watch?v=Jr8hJdVGHAk" target="_blank" rel="external">Daniel Lew</a></li>
<li><a href="http://blog.danlew.net/2016/07/19/a-deep-dive-into-android-view-constructors/" target="_blank" rel="external">View Constructor</a></li>
<li><a href="https://www.youtube.com/watch?v=TIHXGwRTMWI" target="_blank" rel="external">IO 2016</a></li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/10/10/theme-versus-style/" class="archive-article-date">
  	<time datetime="2016-10-10T11:35:32.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-10-10</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2016/10/12/2016-10-12-How-the-mainThread-work/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          主线程的工作原理
        
      </div>
    </a>
  
  
    <a href="/2016/10/08/android-7-0-new-features/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">android 7.0一些新特性介绍及适配方案</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
	    <a class="jiathis_button_twitter"></a>
	    <a class="jiathis_button_plus"></a> 
	    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>









      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Haldir
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		root: "/"
	}
</script>

<script src="/./main.js"></script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86665716-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Butterknife/" style="font-size: 10px;">Butterknife</a> <a href="/tags/Handler-Message/" style="font-size: 10px;">Handler Message</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a> <a href="/tags/TouchEvent/" style="font-size: 15px;">TouchEvent</a> <a href="/tags/Window/" style="font-size: 10px;">Window</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/android-7/" style="font-size: 10px;">android 7</a> <a href="/tags/databinding/" style="font-size: 10px;">databinding</a> <a href="/tags/foreground/" style="font-size: 10px;">foreground</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/service/" style="font-size: 10px;">service</a> <a href="/tags/statusBar/" style="font-size: 10px;">statusBar</a> <a href="/tags/transition/" style="font-size: 10px;">transition</a> <a href="/tags/坐标/" style="font-size: 10px;">坐标</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接1</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接2</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接3</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接4</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接5</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">友情链接6</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>